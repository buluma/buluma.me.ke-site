<!DOCTYPE html><html lang="en"><head><meta name="author" content="Connor Leech"><title>Build a blog with the MEAN stack (part 1)</title><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta http-equiv="cleartype" content="on"><meta name="MobileOptimized" content="320"><meta name="HandheldFriendly" content="True"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><meta name="description" content="In this post we parse markdown using Angular 1.x and connect a blogging application with Node.js and MongoDB"><meta name="keywords" content="laravel, aws, javascript, php, developer, software engineer, web development, software, node.js, serverless, lambda, san francisco, bay area, east bay, vue, vuejs, vue.js, vue 2, laravel 5, amazon web services"><meta name="zipcode" content="94501"><meta name="city" content="Alameda"><meta name="state" content="California"><meta name="country" content="United States"><meta name="language" content="EN"><meta property="og:site_name" content="Connor Leech"><!-- Vendor Fonts--><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.1/css/font-awesome.min.css" rel="stylesheet" type="text/css"><link href="/bower_components/animate.css/animate.min.css" rel="stylesheet" type="text/css"><link href="https://fonts.googleapis.com/css?family=Yantramanav" rel="stylesheet"><!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries--><!-- WARNING: Respond.js doesn't work if you view the page via file://--><!--if lt IE 9script(src='https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js')
script(src='https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js')
--><link rel="alternate" href="/atom.xml" title="config.title" type="application/rss2.xml"><link rel="stylesheet" href="/css/main.css"></head><body id="page-top" data-spy="scroll" data-target=".navbar-fixed-top" class="post"><!-- Nav--><nav role="navigation" class="navbar navbar-custom navbar-fixed-top"><div class="container"><div class="navbar-header"><a href="/" class="navbar-brand"><img src="/images/employbl_logo.svg" style="height:100px; width:100px;"></a><button type="button" data-toggle="collapse" data-target=".navbar-main-collapse" class="navbar-toggle"><i class="fa fa-bars"></i></button></div><div class="collapse navbar-collapse navbar-left navbar-main-collapse"></div><div class="collapse navbar-collapse navbar-right navbar-main-collapse"><ul class="nav navbar-nav"><li><a href="/blog" class="page-scroll">Blog</a></li><li><a href="/#about" class="page-scroll">About</a></li></ul></div></div></nav><main id="content"><div id="archive" class="container"><div class="row"> <div class="col-xs-12 col-md-8 col-md-offset-2"><article class="post"><div class="row"><div class="col-md-10 col-md-offset-1"><h1 class="post-title">Build a blog with the MEAN stack (part 1)</h1></div></div><div class="row"><div class="post-meta"><h5><span>Connor Leech</span><span class="date"> - Oct 24, 2015&ensp;in<span class="post-categories">&ensp;<a href="/categories/Angular/" class="post-category">Angular</a></span></span></h5></div></div><div class="post-body"><p>I’m posting a blog post on how to make a blog. So meta.</p>
<p><img src="http://media.giphy.com/media/roLxlT1nPN8GI/giphy.gif" alt=""></p>
<p>Check out the <a href="https://github.com/connor11528/mean-blog" target="_blank" rel="external">SOURCE CODE</a></p>
<h2 id="Get-crackin"><a href="#Get-crackin" class="headerlink" title="Get crackin"></a>Get crackin</h2><p>Install the starter template and change the names, delete the silly image in the README.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">$</span><span class="bash"> git <span class="built_in">clone</span> git@github.com:jasonshark/mean-starter.git</span></div><div class="line"><span class="meta">$</span><span class="bash"> mv mean-starter mean-blog &amp;&amp; <span class="built_in">cd</span> mean-blog</span></div><div class="line"><span class="meta">$</span><span class="bash"> npm install</span></div><div class="line"><span class="meta">$</span><span class="bash"> node server</span></div></pre></td></tr></table></figure>
<p><em>Tip:</em> install nodemon <code>$ npm install nodemon -g</code> and you won’t have to refresh the page all the time</p>
<h2 id="Render-admin-login"><a href="#Render-admin-login" class="headerlink" title="Render admin login"></a>Render admin login</h2><p>There are lots of ways to handle authentication within the meanstack. We’re going to use <a href="http://passportjs.org/" target="_blank" rel="external">Passport.js</a>, the express server and ejs templates. The angular will come in handy once the template is already rendered.</p>
<p>First define our basic routes for the login and register pages. These go in <strong>server/routes.js</strong>.</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">app.<span class="keyword">use</span>(<span class="string">'/api'</span>, apiRouter);	<span class="comment">// haven't built any api yet</span></div><div class="line">	app.<span class="keyword">use</span>(<span class="string">'/'</span>, router);</div><div class="line"></div><div class="line">	<span class="comment">// home route</span></div><div class="line">	router.get(<span class="string">'/'</span>, <span class="function"><span class="keyword">function</span><span class="params">(req, res)</span> </span>&#123;</div><div class="line">		res.render(<span class="string">'index'</span>);</div><div class="line">	&#125;);</div><div class="line"></div><div class="line">	<span class="comment">// admin route</span></div><div class="line">	router.get(<span class="string">'/admin'</span>, <span class="function"><span class="keyword">function</span><span class="params">(req, res)</span> </span>&#123;</div><div class="line">		res.render(<span class="string">'admin/login'</span>);</div><div class="line">	&#125;);</div><div class="line"></div><div class="line">	router.get(<span class="string">'/admin/register'</span>, <span class="function"><span class="keyword">function</span><span class="params">(req, res)</span> </span>&#123;</div><div class="line">		res.render(<span class="string">'admin/register'</span>);</div><div class="line">	&#125;);</div></pre></td></tr></table></figure>
<p>Now let’s set up the views. We are going to add the ejs template engine and store the views in a new folder called views. First we’ll configure the server to render ejs templates. Add this to the <strong>server.js</strong> express config block:</p>
<p><code>app.set(&#39;view engine&#39;, &#39;ejs&#39;);</code></p>
<p>And add ejs as a dependency for the server:</p>
<p><code>$ npm install ejs --save</code></p>
<p>Next create the views folder and files:
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$ mkdir views</div><div class="line">$ mv public/index<span class="selector-class">.html</span> views/index<span class="selector-class">.ejs</span></div><div class="line">$ mkdir views/admin</div><div class="line">$ touch views/<span class="number">404</span><span class="selector-class">.ejs</span> views/admin/login<span class="selector-class">.ejs</span> views/admin/register<span class="selector-class">.ejs</span> views/admin/dashboard.ejs</div></pre></td></tr></table></figure></p>
<p>In the <strong>views/admin/login.ejs</strong> we will render a basic login form. This will load a full html page with a new <code>&lt;head&gt;</code> and <code>&lt;body&gt;</code>. The body of the template looks like this:</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">&lt;body&gt;</div><div class="line">  &lt;<span class="selector-tag">div</span> class=<span class="string">'container'</span>&gt;</div><div class="line">    &lt;<span class="selector-tag">div</span> class=<span class="string">'row'</span>&gt;</div><div class="line">		&lt;<span class="selector-tag">div</span> class=<span class="string">'col-sm-4 col-sm-offset-4 text-center'</span>&gt;</div><div class="line">			&lt;h1&gt;Admin Login&lt;/h1&gt;</div><div class="line">			&lt;<span class="selector-tag">form</span> method=<span class="string">'post'</span> action=<span class="string">'/login'</span>&gt;</div><div class="line">				&lt;<span class="selector-tag">input</span> type=<span class="string">'text'</span> placeholder=<span class="string">'Email'</span> name=<span class="string">'email'</span> ng-model=<span class="string">'user.email'</span> class=<span class="string">'form-control'</span>&gt;</div><div class="line"></div><div class="line">				&lt;<span class="selector-tag">input</span> type=<span class="string">'password'</span> placeholder=<span class="string">'Password'</span> name=<span class="string">'password'</span> ng-model=<span class="string">'user.password'</span> class=<span class="string">'form-control'</span>&gt;</div><div class="line">				&lt;<span class="selector-tag">input</span> type=<span class="string">'submit'</span> class=<span class="string">'btn btn-primary'</span> value=<span class="string">'Login'</span>&gt;</div><div class="line">			&lt;/form&gt;</div><div class="line">			&lt;<span class="selector-tag">a</span> href=<span class="string">'/admin/register'</span>&gt;Register <span class="selector-tag">a</span> new account&lt;/a&gt;</div><div class="line">		&lt;/div&gt;</div><div class="line">	&lt;/div&gt;</div><div class="line">  &lt;/div&gt;</div><div class="line">&lt;/body&gt;</div></pre></td></tr></table></figure>
<p>Make sure to include bootstrap CSS and you’re golden. The register form looks like this:</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">&lt;body&gt;</div><div class="line">  &lt;<span class="selector-tag">div</span> class=<span class="string">'container'</span>&gt;</div><div class="line">    &lt;<span class="selector-tag">div</span> class=<span class="string">'row'</span>&gt;</div><div class="line">      &lt;<span class="selector-tag">div</span> class=<span class="string">'col-sm-4 col-sm-offset-4 text-center'</span>&gt;</div><div class="line">        &lt;h1&gt;New user registration&lt;/h1&gt;</div><div class="line">        &lt;<span class="selector-tag">form</span> &lt;<span class="selector-tag">form</span> method=<span class="string">'post'</span> action=<span class="string">'/register'</span>&gt;</div><div class="line">          &lt;<span class="selector-tag">input</span> type=<span class="string">'text'</span> placeholder=<span class="string">'Email'</span> name=<span class="string">'email'</span> ng-model=<span class="string">'user.email'</span> class=<span class="string">'form-control'</span>&gt;</div><div class="line"></div><div class="line">          &lt;<span class="selector-tag">input</span> type=<span class="string">'password'</span> placeholder=<span class="string">'Password'</span> name=<span class="string">'password'</span> ng-model=<span class="string">'user.password'</span> class=<span class="string">'form-control'</span>&gt;</div><div class="line">          &lt;<span class="selector-tag">input</span> type=<span class="string">'submit'</span> class=<span class="string">'btn btn-primary'</span> value=<span class="string">'Register'</span>&gt;</div><div class="line">        &lt;/form&gt;</div><div class="line">        &lt;<span class="selector-tag">a</span> href=<span class="string">'/admin'</span>&gt;Login with an existing account&lt;/a&gt;</div><div class="line">      &lt;/div&gt;</div><div class="line">    &lt;/div&gt;</div><div class="line">  &lt;/div&gt;</div><div class="line">&lt;/body&gt;</div></pre></td></tr></table></figure>
<p>Almost exactly the same. You can now check out the basic forms by navigating to <code>/admin</code> and <code>/admin/register</code>. The next step will be creating users and logging them in</p>
<h2 id="Create-user-model-and-set-up-passport"><a href="#Create-user-model-and-set-up-passport" class="headerlink" title="Create user model and set up passport"></a>Create user model and set up passport</h2><p>So in order to have admins we’re going to create a user model in our database. Create the model in <strong>server/models/user.js</strong>:</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> mongoose = <span class="built_in">require</span>(<span class="string">'mongoose'</span>),</div><div class="line">    passportLocalMongoose = <span class="built_in">require</span>(<span class="string">'passport-local-mongoose'</span>);</div><div class="line"></div><div class="line"><span class="keyword">var</span> User = <span class="keyword">new</span> mongoose.Schema(&#123;</div><div class="line">	email: &#123;</div><div class="line">		<span class="keyword">type</span>: <span class="built_in">String</span>, </div><div class="line">		required: <span class="string">'&#123;PATH&#125; is required!'</span></div><div class="line">	&#125;</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">// Passport-Local-Mongoose will add a username, </span></div><div class="line"><span class="comment">// hash and salt field to store the username, </span></div><div class="line"><span class="comment">// the hashed password and the salt value</span></div><div class="line"></div><div class="line"><span class="comment">// configure to use email for username field</span></div><div class="line">User.plugin(passportLocalMongoose, &#123; usernameField: <span class="string">'email'</span> &#125;);</div><div class="line"></div><div class="line"><span class="built_in">module</span>.exports = mongoose.model(<span class="string">'User'</span>, User);</div></pre></td></tr></table></figure>
<p>To make user management with passport.js simple we’re using <a href="https://github.com/saintedlama/passport-local-mongoose" target="_blank" rel="external">passport-local-mongoose</a>, which is a layer of abstraction on top of <a href="https://github.com/jaredhanson/passport-local" target="_blank" rel="external">passport-local</a>. Passport local is an “authentication strategy” on top of passport. You can include multiple strategies for different providers. This confused me for a long time. Scotch.io has a great <a href="https://scotch.io/tutorials/easy-node-authentication-setup-and-local" target="_blank" rel="external">tutorial series</a> on authenticating with multiple strategies in an express app. I also have an <a href="https://github.com/connor11528/express-auth" target="_blank" rel="external">example app</a> that implements login with email/password, facebook and spotify together as one. For now we’re going to keep moving forward.</p>
<p><img src="http://media.giphy.com/media/1sSWWMNnaZLlm/giphy.gif" alt="keep swimming"></p>
<p>Install the dependencies:
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ npm <span class="keyword">install</span> passport passport-<span class="keyword">local</span> passport-<span class="keyword">local</span>-mongoose <span class="comment">--save</span></div></pre></td></tr></table></figure></p>
<p>Initialize passport.js sessions in <strong>server.js</strong>:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> passport = <span class="keyword">require</span>(<span class="string">'passport'</span>);</div><div class="line"><span class="keyword">require</span>(<span class="string">'./server/passport'</span>)(passport);   <span class="comment">// this file is defined below</span></div><div class="line">app.<span class="keyword">use</span>(passport.initialize());</div><div class="line">app.<span class="keyword">use</span>(passport.session());</div></pre></td></tr></table></figure>
<p>Define the passport configuration options in <strong>server/passport.js</strong>. I got this directly form the passport-local-mongoose <a href="https://github.com/saintedlama/passport-local-mongoose" target="_blank" rel="external">README</a>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// requires the model with Passport-Local Mongoose plugged in</span></div><div class="line"><span class="keyword">var</span> User = <span class="built_in">require</span>(<span class="string">'./models/user'</span>),</div><div class="line">	LocalStrategy = <span class="built_in">require</span>(<span class="string">'passport-local'</span>).Strategy;</div><div class="line"></div><div class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span>(<span class="params">passport</span>)</span>&#123;</div><div class="line">	<span class="comment">// use static authenticate method of model in LocalStrategy</span></div><div class="line">	passport.use(User.createStrategy());</div><div class="line"></div><div class="line">	<span class="comment">// use static serialize and deserialize of model for passport session support</span></div><div class="line">	passport.serializeUser(User.serializeUser());</div><div class="line">	passport.deserializeUser(User.deserializeUser());</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<h2 id="Create-routes-for-handling-user-login-registration"><a href="#Create-routes-for-handling-user-login-registration" class="headerlink" title="Create routes for handling user login/registration"></a>Create routes for handling user login/registration</h2><p>We have our forms that send plain old POST request. Set up some express routes with passport.js magical middleware. Middleware in express are functions that the request passes through when a route is hit. The request hits the route (for example POST to “/login”) and then goes through a series of functions that take the format <code>function(req, res, next){}</code>. If the <code>next()</code> function gets called the request continues down the chain. Passport provides us middleware that follows this <code>req, res, next</code> pattern:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line">router.get(<span class="string">'/admin/dashboard'</span>, isAdmin, <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>)</span>&#123;</div><div class="line">		res.render(<span class="string">'admin/dashboard'</span>, &#123;<span class="attr">user</span>: req.user&#125;);</div><div class="line">	&#125;);</div><div class="line"></div><div class="line">	router.post(<span class="string">'/register'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>)</span>&#123;</div><div class="line"></div><div class="line">		<span class="comment">// passport-local-mongoose: Convenience method to register a new user instance with a given password. Checks if username is unique</span></div><div class="line">		User.register(<span class="keyword">new</span> User(&#123;</div><div class="line">			<span class="attr">email</span>: req.body.email</div><div class="line">		&#125;), req.body.password, <span class="function"><span class="keyword">function</span>(<span class="params">err, user</span>) </span>&#123;</div><div class="line">	        <span class="keyword">if</span> (err) &#123;</div><div class="line">	            <span class="built_in">console</span>.error(err);</div><div class="line">	            <span class="keyword">return</span>;</div><div class="line">	        &#125;</div><div class="line"></div><div class="line">	        <span class="comment">// log the user in after it is created</span></div><div class="line">	        passport.authenticate(<span class="string">'local'</span>)(req, res, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">	        	<span class="built_in">console</span>.log(<span class="string">'authenticated by passport'</span>);</div><div class="line">	        	res.redirect(<span class="string">'/admin/dashboard'</span>);</div><div class="line">	        &#125;);</div><div class="line">	    &#125;);</div><div class="line">	&#125;);</div><div class="line"></div><div class="line">	router.post(<span class="string">'/login'</span>, passport.authenticate(<span class="string">'local'</span>), <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>)</span>&#123;</div><div class="line">		res.redirect(<span class="string">'/admin/dashboard'</span>);</div><div class="line">	&#125;);</div><div class="line"></div><div class="line">	app.use(<span class="function"><span class="keyword">function</span>(<span class="params">req, res, next</span>)</span>&#123;</div><div class="line">		res.status(<span class="number">404</span>);</div><div class="line"></div><div class="line">		res.render(<span class="string">'404'</span>);</div><div class="line">		<span class="keyword">return</span>;</div><div class="line">	&#125;);</div></pre></td></tr></table></figure>
<p>Make sure you have the mongoose User model defined:</p>
<p><code>var User = require(&#39;./models/user&#39;)</code></p>
<p>You’ll see that I threw in an <code>isAdmin</code> variable. That is some middleware I defined myself. It is janky but it will make sure that even if someone registers an account they cannot get to the dashboard unless they log in with my email address.</p>
<figure class="highlight monkey"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">isAdmin</span>(</span>req, res, <span class="keyword">next</span>)&#123;</div><div class="line">	<span class="keyword">if</span>(req.isAuthenticated() &amp;&amp; req.user.email === <span class="comment">'connorleech@gmail.com')&#123;</span></div><div class="line">		console.<span class="built_in">log</span>(<span class="comment">'cool you are an admin, carry on your way');</span></div><div class="line">		<span class="keyword">next</span>();</div><div class="line">	&#125; <span class="keyword">else</span> &#123;</div><div class="line">		console.<span class="built_in">log</span>(<span class="comment">'You are not an admin');</span></div><div class="line">		res.redirect(<span class="comment">'/admin');</span></div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>For more complex apps you could add roles to users. You could add roles by issuing commands to records in MongoDB directly. Here’s how to check out the contents of our database (go ahead and <code>/admin/register</code> first, so you have some data to look at!)</p>
<h2 id="Check-in-the-database-that-users-exist"><a href="#Check-in-the-database-that-users-exist" class="headerlink" title="Check in the database that users exist"></a>Check in the database that users exist</h2><p>Let’s check out our database. Open up a mongo shell (<code>$ mongod</code> must be running).</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">$ mongo</div><div class="line">&gt; show dbs</div><div class="line">ghost-clone     0.078GB</div><div class="line">test            0.078GB</div><div class="line">&gt; use ghost-clone</div><div class="line">switched <span class="keyword">to</span> db ghost-clone</div><div class="line">&gt; show collections</div><div class="line">system.indexes<span class="built_in"></span></div><div class="line">users</div><div class="line">&gt; db.users.<span class="builtin-name">find</span>();</div></pre></td></tr></table></figure>
<p>This changes into our database and shows the users. The database may be called “mean-starter” if you do not rename the development database in <strong>server/env.js</strong>.</p>
<h4 id="Set-up-the-admin-dashboard"><a href="#Set-up-the-admin-dashboard" class="headerlink" title="Set up the admin dashboard"></a>Set up the admin dashboard</h4><p>We’ve created users in the database and logged them in. What we actually want is a protected dashboard where we can create, edit and save our posts.</p>
<p>First we’re going to set up the layout and create a new angular app called <code>ghost-clone.admin</code>. This app will handle everything that goes on from the <strong>dashboard.ejs</strong> template. I’ve set it up a little like how the ghost platform works. We can add more functionality in later tutorials.</p>
<p><img src="http://cdn.meme.am/instances2/500x/700982.jpg" alt=""></p>
<p>I changed the <code>public/</code> directory to distinguish between our admin angular app and the home angular app:</p>
<figure class="highlight 1c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">public</div><div class="line">  <span class="string">|- admin</span></div><div class="line">     <span class="string">|- js</span></div><div class="line">     <span class="string">|- css</span></div><div class="line">     <span class="string">|- templates</span></div><div class="line">  <span class="string">|- home</span></div><div class="line">     <span class="string">|- js</span></div><div class="line">     <span class="string">|- css</span></div><div class="line">     <span class="string">|- templates</span></div></pre></td></tr></table></figure>
<p>Create the angular app in <strong>public/admin/js/app.js</strong>:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> adminApp = angular.module(<span class="string">'ghost-clone.admin'</span>, [</div><div class="line">	<span class="string">'ui.router'</span>,</div><div class="line">	<span class="string">'btford.markdown'</span></div><div class="line">]);</div><div class="line"></div><div class="line">adminApp.config(<span class="function"><span class="keyword">function</span><span class="params">($stateProvider, $urlRouterProvider)</span></span>&#123;</div><div class="line"></div><div class="line">	$urlRouterProvider.otherwise(<span class="string">'/'</span>);</div><div class="line">	</div><div class="line">	$stateProvider</div><div class="line">		.state(<span class="string">'allPosts'</span>, &#123;</div><div class="line">			url: <span class="string">'/'</span>,</div><div class="line">			templateUrl: <span class="string">'/admin/templates/allPosts.html'</span></div><div class="line">		&#125;)</div><div class="line">		.state(<span class="string">'addPost'</span>, &#123;</div><div class="line">			url: <span class="string">'/addPost'</span>,</div><div class="line">			templateUrl: <span class="string">'/admin/templates/addPost.html'</span></div><div class="line">		&#125;)</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>Next we’re going to hand off the user object passport added on the server <code>req.user</code> to our <code>user</code> variable and give that to the angular application.</p>
<figure class="highlight django"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">'/admin/js/app.js'</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></div><div class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">'text/javascript'</span>&gt;</span><span class="actionscript"></span></div><div class="line">    <span class="keyword">var</span> currentUser = <span class="template-tag">&#123;% <span class="name">raw</span> %&#125;</span><span class="xml"><span class="javascript">&lt;%- <span class="built_in">JSON</span>.stringify(user); %&gt;</span></span><span class="template-tag">&#123;% <span class="name">endraw</span> %&#125;</span><span class="xml"><span class="actionscript">;</span></span></div><div class="line">    adminApp.run(<span class="function"><span class="keyword">function</span><span class="params">($rootScope)</span></span>&#123;</div><div class="line">      $rootScope.currentUser = currentUser;</div><div class="line">    &#125;);</div><div class="line">  <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure>
<p>The `<%- -%="">` is how ejs renders variables. We stringify that and then pass it to our $rootScope.</%-></p>
<p><img src="http://cdn.meme.am/instances2/500x/700964.jpg" alt="ejs variables to angular.js"></p>
<p>In the body I link to a navbar template:</p>
<p><code>&lt;div ng-include=&#39;&quot;/admin/templates/nav.html&quot;&#39;&gt;&lt;/div&gt;</code>.</p>
<p>It’s important to note now angular’s using client side templates with ui.router. These are separate from the server-side ejs templates.</p>
<p>So now create a navbar template in <strong>public/admin/templates/nav.html</strong>:</p>
<figure class="highlight django"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="xml"><span class="comment">&lt;!-- Top navigation --&gt;</span></span></div><div class="line"><span class="tag">&lt;<span class="name">nav</span> <span class="attr">class</span>=<span class="string">"navbar navbar-default navbar-fixed-top"</span> <span class="attr">ng-controller</span>=<span class="string">'NavCtrl'</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"navbar-header"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">class</span>=<span class="string">"navbar-toggle collapsed"</span> <span class="attr">data-toggle</span>=<span class="string">"collapse"</span> <span class="attr">data-target</span>=<span class="string">"#navbar"</span> <span class="attr">aria-expanded</span>=<span class="string">"false"</span> <span class="attr">aria-controls</span>=<span class="string">"navbar"</span>&gt;</span></div><div class="line">          <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"sr-only"</span>&gt;</span>Toggle navigation<span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line">          <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"icon-bar"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line">          <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"icon-bar"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line">          <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"icon-bar"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"navbar-brand"</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span>Ghost clone<span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"navbar"</span> <span class="attr">class</span>=<span class="string">"navbar-collapse collapse"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"nav navbar-nav"</span>&gt;</span></div><div class="line">          <span class="tag">&lt;<span class="name">li</span> <span class="attr">ng-class</span>=<span class="string">"&#123; active: isActive('allPosts') &#125;"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">ui-sref</span>=<span class="string">"allPosts"</span>&gt;</span>All posts<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">          <span class="tag">&lt;<span class="name">li</span> <span class="attr">ng-class</span>=<span class="string">"&#123; active: isActive('addPost') &#125;"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">ui-sref</span>=<span class="string">"addPost"</span>&gt;</span>New Post<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"nav navbar-nav navbar-right"</span>&gt;</span></div><div class="line">          <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>&gt;</span><span class="template-tag">&#123;% <span class="name">raw</span> %&#125;</span><span class="xml"></span><span class="template-variable">&#123;&#123;currentUser.email&#125;&#125;</span><span class="xml"></span><span class="template-tag">&#123;% <span class="name">endraw</span> %&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></div><div class="line">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></div><div class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="comment">&lt;!--/.nav-collapse --&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">nav</span>&gt;</span></div><div class="line"><span class="comment">&lt;!-- /Top navigation --&gt;</span></div></pre></td></tr></table></figure>
<p>And also make a <code>NavCtrl</code> for this navbar that will toggle the <code>.active</code> class based on the current $state ui.router is in:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">adminApp.controller(<span class="string">'NavCtrl'</span>, <span class="function"><span class="keyword">function</span><span class="params">($scope, $state)</span></span>&#123;</div><div class="line">	$scope.active = $state;</div><div class="line">	$scope.isActive = <span class="function"><span class="keyword">function</span><span class="params">(viewLocation)</span></span>&#123;</div><div class="line">		<span class="keyword">var</span> active = (viewLocation === $state.current.name);</div><div class="line">		<span class="keyword">return</span> active;</div><div class="line">	&#125;;</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>Below the nav.html tag in <strong>dashboard.ejs</strong> include a space to render our views</p>
<p><code>&lt;div ui-view class=&#39;full-height&#39; id=&#39;main-content&#39;&gt;&lt;/div&gt;</code></p>
<p>Add then paste some CSS into <strong>public/admin/css/main.css</strong>:</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">html</span>, <span class="selector-tag">body</span>, <span class="selector-tag">section</span>, <span class="selector-class">.full-height</span> &#123;</div><div class="line">    <span class="attribute">height</span>: <span class="number">100%</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="selector-id">#pad</span>&#123;</div><div class="line">    <span class="attribute">font-family</span>: Menlo,Monaco,Consolas,<span class="string">"Courier New"</span>,monospace;</div><div class="line"></div><div class="line">    <span class="attribute">border</span>: none;</div><div class="line">    <span class="attribute">overflow</span>: auto;</div><div class="line">    <span class="attribute">outline</span>: none;</div><div class="line">    <span class="attribute">resize</span>: none;</div><div class="line"></div><div class="line">    <span class="attribute">-webkit-box-shadow</span>: none;</div><div class="line">    <span class="attribute">-moz-box-shadow</span>: none;</div><div class="line">    <span class="attribute">box-shadow</span>: none;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="selector-id">#markdown</span> &#123;</div><div class="line">    <span class="attribute">overflow</span>: auto;</div><div class="line">    <span class="attribute">border-left</span>: <span class="number">1px</span> solid black;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="selector-id">#main-content</span> &#123;</div><div class="line">    <span class="attribute">margin-top</span>:<span class="number">70px</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="Parsing-markdown"><a href="#Parsing-markdown" class="headerlink" title="Parsing markdown"></a>Parsing markdown</h2><p>We’re going to create two more templates to add a post and also show all of our posts. Create two files <strong>addPost.html</strong> and <strong>allPosts.html</strong> in <strong>public/admin/templates</strong>.</p>
<p>Next add the <a href="https://github.com/jasonshark/angular-markdown-directive" target="_blank" rel="external">angular-markdown-directive</a>. Grab the <strong>markdown.js</strong> file and include it as a <code>&lt;script&gt;</code> in <strong>dashboard.ejs</strong>.</p>
<p>Also add <code>ngSanitize</code> and the <a href="https://github.com/showdownjs/showdown" target="_blank" rel="external">showdown.js</a> library:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.4.2/angular-sanitize.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">   <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://cdn.rawgit.com/showdownjs/showdown/1.0.2/dist/showdown.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">'/admin/js/lib/markdown.js'</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure>
<p>Then create a template for adding a title and a body. On the right hand column we’ll view the markdown preview of the post we’re posting:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"row full-height"</span>&gt;</div><div class="line">    <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">'col-lg-12'</span>&gt;</span></span></div><div class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">'form-group'</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">'text'</span> <span class="attr">placeholder</span>=<span class="string">'Title'</span> <span class="attr">name</span>=<span class="string">'title'</span> <span class="attr">class</span>=<span class="string">'form-control'</span>&gt;</span></div><div class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-lg-12 full-height"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">textarea</span> <span class="attr">class</span>=<span class="string">"col-md-6 full-height"</span> <span class="attr">id</span>=<span class="string">"pad"</span> <span class="attr">ng-model</span>=<span class="string">'text'</span> <span class="attr">placeholder</span>=<span class="string">'Write your blog post here...'</span>&gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-md-6 full-height"</span> <span class="attr">id</span>=<span class="string">"markdown"</span>&gt;</span></div><div class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">btf-markdown</span>=<span class="string">'text'</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure>
<p>Navigate to New Post (<a href="http://localhost:3000/admin/dashboard#/addPost" target="_blank" rel="external">http://localhost:3000/admin/dashboard#/addPost</a>), start typing a <code># title</code> and you’ll see the markdown preview version, thanks to showdown.js and angular.js data binding.</p>
<h2 id="Conclusion-for-now"><a href="#Conclusion-for-now" class="headerlink" title="Conclusion (for now)"></a>Conclusion <small>(for now)</small></h2><p>We have a database of users, protected admin access, two angular applications and a template for parsing markdown.</p>
<p>In the next post we will Create, Read, Update and Delete posts. If you have questions about this tutorial, feel free to <a href="http://twitter.com/cleechtech" target="_blank" rel="external">hit me up on twitter</a>.</p>
<p><img src="http://media0.giphy.com/media/V0BIjUQRfl8tO/giphy.gif" alt=""></p>
<p>Also check out the <a href="https://github.com/jasonshark/mean-blog" target="_blank" rel="external">SOURCE CODE</a>.</p>
</div></article><nav class="pagination"><a href="/blog/facebook-auth-with-ionic-and-firebase/" title="Facebook authentication with Ionic 1.x and Firebase" class="btn-default entry-pagination__link entry-pagination__link--prev">Prev</a><a href="/blog/Set-up-drf-to-play-well-with-angular-templates/" title="Set up Django Rest Framework (DRF) to play well with Angular.js templates" class="btn-default entry-pagination__link entry-pagination__link--next">Next</a></nav></div></div></div></main><footer class="footer"><div class="container"><div class="row"><div class="col-sm-3"></div><div class="col-sm-3"></div><div class="col-sm-3"><h4>Connect</h4><ul><li> <a target="_blank" href="https://github.com/connor11528">GitHub</a></li><li> <a target="_blank" href="https://www.linkedin.com/in/connorleech">LinkedIn</a></li><li> <a target="_blank" href="https://twitter.com/connor11528">Twitter</a></li></ul></div><div class="col-sm-3"><h4>Inquiries?</h4><ul><li> <a href="mailto:connorleech@gmail.com">connorleech@gmail.com</a></li></ul></div></div></div></footer><!-- vendor--><script src="/bower_components/jquery/dist/jquery.min.js"></script><script src="/bower_components/bootstrap/dist/js/bootstrap.min.js"></script><script src="/bower_components/wow/dist/wow.min.js"></script><script src="/bower_components/jquery-easing/jquery.easing.min.js"></script><script src="/bower_components/jquery-color/jquery.color.js"></script><script src="/bower_components/scrollmagic/scrollmagic/minified/ScrollMagic.min.js"></script><script src="/bower_components/scrollmagic/scrollmagic/minified/plugins/debug.addIndicators.min.js"></script><script src="/bower_components/vivus/dist/vivus.min.js"></script><!-- require modules--><script src="/js/require.js"></script><script src="/js/app.js"></script><!-- analytics--></body></html>